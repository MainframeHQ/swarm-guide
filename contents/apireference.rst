.. _API Reference:

*************************
API Reference
*************************



HTTP
=========================

+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Name          | Method | Descriptors   |                                                                                                                                                                                                                                                                                                                                                             |
+===============+========+===============+=============================================================================================================================================================================================================================================================================================================================================================+
| bzz           | GET    | Purpose       | retrieve document at domain/some/path allowing domain to resolve via the :ref:`Ethereum Name Service`                                                                                                                                                                                                                                                       |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz:/<domain_part>/<resource_path>                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part: mandatory - ENS name or a valid swarm hash. path part: optional - a case insensitive path to match for in the manifest                                                                                                                                                                                                                         |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 300; 404; 500                                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | The content stored at the resolved ENS entry (or the matched path) with the appropriate Content-Type as stored in the manifest                                                                                                                                                                                                                              |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               | POST   | Purpose       | post an application/x-tar or multipart/form-data (or any other Content-Type for that matter); create an appropriate manifest and retrieve the associated hash. if an existing manifest address is given with the according path to update - a copy of the manifest will be created with the updated entry and the hash of the new manifest will be returned |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz:/<manifest_hash?>/<resource_path?>/<encrypt?>                                                                                                                                                                                                                                                                                                           |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | manifest hash - optional - an existing manifest address to update a resource included in the manifest. resource path - optional - which resource to update in the manifest. encrypt - optional flag to enable encryption                                                                                                                                    |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200                                                                                                                                                                                                                                                                                                                                                         |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | a hash of a newly created manifest                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               | DELETE | Purpose       | delete a resource from a manifest by unlinking it from the existing manifest                                                                                                                                                                                                                                                                                |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz:/<domain>/<path>                                                                                                                                                                                                                                                                                                                                        |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part - mandatory - a valid ENS hash or a valid swarm manifest hash. path part - mandatory - a path to the resource to be removed from the manifest                                                                                                                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | the hash of the new manifest which does not have component ``path``                                                                                                                                                                                                                                                                                         |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-immutable | GET    | Purpose       | The same as the generic scheme but there is no ENS domain resolution. the domain part of the path needs to be a valid hash. This is also a read-only scheme but explicit in its integrity protection. A particular bzz-immutable url will always necessarily address the exact same fixed immutable content.                                                |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-immutable:/<hash>                                                                                                                                                                                                                                                                                                                                       |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | hash part - a valid swarm hash that points to a manifest                                                                                                                                                                                                                                                                                                    |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | the resolved content at the specified address with a valid content-type as stored in the manifest                                                                                                                                                                                                                                                           |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       | use bzz-hash to resolve the ens name into a hash then use it with immutable                                                                                                                                                                                                                                                                                 |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-raw       | GET    | Purpose       | When responding to GET requests with the bzz-raw scheme swarm does not assume a manifest but just serves the asset addressed by the url directly. The ``content_type`` query parameter can be supplied to specify the mime type you are requesting otherwise content is served as an octet stream per default.                                              |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-raw:/<content_hash>?content_type=<mime>                                                                                                                                                                                                                                                                                                                 |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | content hash - mandatory - a valid swarm content hash. content type - optional - the mime type to serve the content as. defaults to application/octet-stream                                                                                                                                                                                                |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       | a pdf document (not the manifest wrapping it) resides at hash 6a182226... then the following url will properly serve it: GET http://localhost:8500/bzz-raw:/6a18222637cafb4ce692fa11df886a03e6d5e63432c53cbf7846970aa3e6fdf5?content_type=application/pdf                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               | POST   | Purpose       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-list      | GET    | Purpose       | Returns a list of all files contained in <manifest> under <path> grouped into common prefixes using ``/`` as a delimiter. If path is ``/`` - all files in manifest are returned. The response is a JSON-encoded object with ``common_prefixes`` string field and ``entries`` list field.                                                                    |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-list:/<domain>/<path>                                                                                                                                                                                                                                                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part - mandatory - a valid ENS entry that points to a valid manifest hash or a valid manifest hash. path part - optional - path to look for inside the manifest                                                                                                                                                                                      |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| bzz-hash      | GET    | Purpose       | responds with the hash value of the raw content - the same content returned by requests with bzz-raw scheme. Hash of the manifest is also the hash stored in ENS so bzz-hash can be used for ENS domain resolution                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator       | bzz-hash:/<domain>                                                                                                                                                                                                                                                                                                                                          |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Locator Parts | domain part - mandatory. a valid ENS name                                                                                                                                                                                                                                                                                                                   |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | HTTP Codes    | 200; 404; 500                                                                                                                                                                                                                                                                                                                                               |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Responds with | text/plain                                                                                                                                                                                                                                                                                                                                                  |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|               |        | Example       |                                                                                                                                                                                                                                                                                                                                                             |
+---------------+--------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+


JavaScript
========================
Swarm currently supports a Javascript API through a couple of packages:

swarm-js
^^^^^^^^^^^^^^^

`swarm-js <https://github.com/MaiaVictor/swarm-js>`_ is available through `NPM <https://www.npmjs.com/package/swarm-js>`_ by issuing
the following command:

.. code-block:: none
  
  npm install swarm-js


.. note:: Full documentation is available on the `GitHub <https://github.com/MaiaVictor/swarm-js>`_ page.

swarmgw
^^^^^^^^^^

`swarmgw <https://github.com/axic/swarmgw>`_ is available through `NPM <https://www.npmjs.com/package/swarmgw>`_ by issuing
the following command:

.. code-block:: none
  
  npm install swarmgw

When installed globally, it can also be used directly from the CLI:

.. code-block:: none

  npm install -g swarmgw

.. note:: Full documentation is available on the `GitHub <https://github.com/axic/swarmgw>`_ page.





IPC
========================

Swarm exposes an IPC API under the ``bzz`` namespace.


FUSE
^^^^^^

``swarmfs.mount(HASH|domain, mountpoint))``
  mounts swarm contents represented by a swarm hash or a ens domain name to the specified local directory. The local directory has to be writable and should be empty.
  Once this command is succesfull, you should see the contents in the local directory. The HASH is mounted in a rw mode, which means any change insie the directory will be automatically reflected in swarm. Ex: if you copy a file from somewhere else in to mountpoint, it is equvivalent of using a "swarm up <file>" command.    

``swarmfs.unmount(mountpoint)``
  This command unmounts the HASH|domain mounted in the specified mountpoint. If the device is busy, unmounting fails. In that case make sure you exit the process that is using the directory and try unmounting again.

``swarmfs.listmounts()``
  For every active mount, this command display three things. The mountpoint, start HASH supplied and the latest HASH. Since the HASH is mounted in rw mode, when ever there is a change to the file system (adding file, removing file etc), a new HASH is computed. This hash is called the latest HASH.


.. uncommentthisChequebook IPC API
.. uncommentthis------------------------------

.. uncommentthisSwarm also exposes an IPC API for the chequebook offering the followng methods:

.. uncommentthis``chequebook.balance()``
.. uncommentthis  Returns the balance of your swap chequebook contract in wei.
.. uncommentthis  It errors if no chequebook is set.

.. uncommentthis``chequebook.issue(beneficiary, value)``
.. uncommentthis  Issues a cheque to beneficiary (an ethereum address) in the amount of value (given in wei). The json structure returned can be copied and sent to beneficiary who in turn can cash it using ``chequebook.cash(cheque)``.
.. uncommentthis  It errors if no chequebook is set.

.. uncommentthis``chequebook.cash(cheque)``
.. uncommentthis  Cashes the cheque issued. Note that anyone can cash a cheque. Its success only depends on the cheque's validity and the solvency of the issuers chequbook contract up to the amount specified in the cheque. The tranasction is paid from your bzz base account.
.. uncommentthis  Returns the transaction hash.
.. uncommentthis  It errors if no chequebook is set or if your account has insufficient funds to send the transaction.

.. uncommentthis``chequebook.deposit(amount)``
.. uncommentthis  Transfers funds of amount  wei from your bzz base account to your swap chequebook contract.
.. uncommentthis  It errors if no chequebook is set  or if your account has insufficient funds.